<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的進化版文章空間</title>
    
    <!-- 引入 Marked.js 函式庫來解析 Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- CSS 樣式區塊 -->
    <style>
        /* --- 全域設定與變數 --- */
        :root {
            --primary-color: #007bff; /* 活力藍 */
            --secondary-color: #343a40; /* 深灰 */
            --background-color: #f8f9fa; /* 更亮的背景 */
            --card-bg-color: #ffffff;
            --font-color: #212529;
            --light-gray: #dee2e6;
            --border-radius: 12px;
            --transition-speed: 0.5s;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            background-color: var(--background-color);
            color: var(--font-color);
            line-height: 1.7;
            overflow-x: hidden; /* 防止頁面切換時出現水平滾動條 */
        }

        /* --- 主要視圖容器 --- */
        .view {
            transition: transform var(--transition-speed) ease-in-out, opacity var(--transition-speed) ease-in-out;
        }
        #grid-view {
            position: relative;
            z-index: 10;
        }
        #article-view {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--background-color);
            transform: translateX(100%); /* 預設移出畫面右側 */
            opacity: 0;
            z-index: 20;
            overflow-y: auto;
            padding: 2rem 5%;
            box-sizing: border-box;
        }
        #article-view.visible {
            transform: translateX(0);
            opacity: 1;
        }
        
        /* --- 頁首與導航 --- */
        .header {
            background-color: var(--card-bg-color);
            padding: 1rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            border-bottom: 1px solid var(--light-gray);
        }
        .header h1 { margin: 0; font-size: 1.8rem; }
        .header-controls button {
            background-color: var(--primary-color);
            color: white; border: none; padding: 0.6rem 1.2rem;
            border-radius: 8px; cursor: pointer; transition: background-color 0.3s;
            margin-left: 1rem;
        }
        .header-controls button:hover { background-color: #0056b3; }
        #edit-mode-toggle.active { background-color: #dc3545; }
        #new-post-btn { display: none; } /* 預設隱藏 */

        .navbar { text-align: center; padding: 1rem 0; background-color: var(--card-bg-color); }
        .nav-btn {
            background: none; border: 1px solid var(--light-gray); color: var(--secondary-color);
            padding: 0.6rem 1.2rem; margin: 0 0.5rem; border-radius: 20px;
            cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;
        }
        .nav-btn:hover { background-color: #e9ecef; border-color: #e9ecef; }
        .nav-btn.active { background-color: var(--secondary-color); color: white; border-color: var(--secondary-color); }

        /* --- 文章網格與卡片 --- */
        main { padding: 2rem 5%; }
        #articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
        }
        .article-card {
            background-color: var(--card-bg-color);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 25px rgba(0,0,0,0.06);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .article-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.1);
        }
        .card-image {
            width: 100%;
            height: 200px;
            object-fit: cover; /* 關鍵：讓圖片填滿容器不變形 */
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }
        .card-content { padding: 1.5rem; flex-grow: 1; }
        .card-content h3 { margin-top: 0; margin-bottom: 0.5rem; color: var(--secondary-color); }
        .card-content p { color: #6c757d; font-size: 0.95rem; margin-bottom: 1rem; }
        .card-tags .tag {
            display: inline-block;
            background-color: #e9ecef; color: #495057;
            padding: 0.3rem 0.8rem; font-size: 0.75rem;
            border-radius: 15px; font-weight: 500;
        }
        /* 不同分類的標籤顏色 */
        .tag.tech { background-color: #e7f3ff; color: #007bff; }
        .tag.life { background-color: #e8f5e9; color: #28a745; }
        .tag.travel { background-color: #fff8e1; color: #ffc107; }

        /* --- 單篇文章/編輯頁面 --- */
        .article-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        #back-to-grid-btn {
            background: var(--secondary-color); color: white; border: none; padding: 0.8rem 1.5rem;
            border-radius: 8px; cursor: pointer; font-size: 1rem;
        }
        #article-content-rendered { line-height: 1.8; }
        #article-content-rendered h1, #article-content-rendered h2 { border-bottom: 1px solid var(--light-gray); padding-bottom: 0.5rem; margin-top: 2rem; }
        #article-content-rendered p { margin-bottom: 1.2rem; }
        #article-content-rendered code { background-color: #e9ecef; padding: 0.2em 0.4em; border-radius: 3px; font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace; }
        #article-content-rendered pre { background-color: #212529; color: #f8f9fa; padding: 1rem; border-radius: 8px; overflow-x: auto; }
        #article-content-rendered blockquote { border-left: 4px solid var(--light-gray); padding-left: 1rem; color: #6c757d; margin-left: 0; }
        #article-content-rendered ul, #article-content-rendered ol { padding-left: 1.5rem; }

        .edit-form .form-group { margin-bottom: 1.5rem; }
        .edit-form label { display: block; font-weight: bold; margin-bottom: 0.5rem; }
        .edit-form input, .edit-form textarea {
            width: 100%; padding: 0.8rem; font-size: 1rem; border: 1px solid var(--light-gray);
            border-radius: 8px; box-sizing: border-box; transition: border-color 0.3s, box-shadow 0.3s;
        }
        .edit-form input:focus, .edit-form textarea:focus {
            outline: none; border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
        }
        #article-content-textarea { height: 50vh; resize: vertical; font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace; line-height: 1.6; }
        #save-post-btn {
            background-color: #28a745; color: white; border: none; padding: 0.8rem 2rem;
            border-radius: 8px; cursor: pointer; font-size: 1.1rem; float: right;
        }

        /* --- 工具類 --- */
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- 主網格視圖 -->
    <div id="grid-view" class="view">
        <header class="header">
            <h1>我的進化版文章空間</h1>
            <div class="header-controls">
                <button id="new-post-btn">新增文章</button>
                <button id="edit-mode-toggle">啟用編輯模式</button>
            </div>
        </header>

        <nav class="navbar">
            <button class="nav-btn active" data-category="all">所有文章</button>
            <button class="nav-btn" data-category="tech">技術分享</button>
            <button class="nav-btn" data-category="life">生活隨筆</button>
            <button class="nav-btn" data-category="travel">旅行紀錄</button>
        </nav>

        <main>
            <div id="articles-grid">
                <!-- 文章卡片將由 JS 動態生成 -->
            </div>
        </main>
    </div>

    <!-- 單篇文章/編輯視圖 -->
    <div id="article-view" class="view">
        <div class="article-header">
            <button id="back-to-grid-btn">&larr; 返回列表</button>
        </div>
        
        <!-- 瀏覽模式下顯示的內容 -->
        <div id="article-content-rendered"></div>
        
        <!-- 編輯模式下顯示的表單 -->
        <div id="article-edit-form" class="edit-form hidden">
            <div class="form-group">
                <label for="article-title-input">文章標題</label>
                <input type="text" id="article-title-input">
            </div>
            <div class="form-group">
                <label for="article-category-select">文章分類</label>
                <select id="article-category-select">
                    <option value="tech">技術分享</option>
                    <option value="life">生活隨筆</option>
                    <option value="travel">旅行紀錄</option>
                </select>
            </div>
            <div class="form-group">
                <label for="article-image-input">圖片關鍵字 (英文，例如: nature, tokyo, code)</label>
                <input type="text" id="article-image-input">
            </div>
            <div class="form-group">
                <label for="article-content-textarea">文章內容 (支援 Markdown)</label>
                <textarea id="article-content-textarea"></textarea>
            </div>
            <button id="save-post-btn">儲存文章</button>
        </div>
    </div>


    <!-- JavaScript 功能區塊 -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 狀態與資料管理 ---
            const adminPassword = '980621'; // 已更新您的密碼
            let isEditMode = false;
            let articles = [];
            let currentEditingId = null;

            // 預設文章 (現在包含 imageKeyword)
            const defaultArticles = [
                { id: 1, category: 'tech', title: 'Markdown 語法指南', imageKeyword: 'writing,code', content: '# 歡迎使用 Markdown\n\n這是一個使用 Markdown 語法寫成的範例。\n\n## 列表\n\n*   項目一\n*   項目二\n*   項目三\n\n## 程式碼區塊\n\n```javascript\nconsole.log("Hello, Markdown!");\n```\n\n> 這是一個引言區塊。自由書寫，盡情發揮！' },
                { id: 2, category: 'life', title: '週末的烘焙時光', imageKeyword: 'baking,coffee', content: '午後的陽光正好，烤箱傳來陣陣香氣。自己動手做的巴斯克乳酪蛋糕，雖然外觀不完美，但每一口都是滿滿的幸福感。' },
                { id: 3, category: 'travel', title: '探索冰島的極光', imageKeyword: 'iceland,aurora', content: '追逐極光是一場與大自然的浪漫約會。當那道綠色的光帶在夜空中舞動時，所有的等待都化為了無與倫比的震撼。' },
                { id: 4, category: 'tech', title: '前端框架大比拼', imageKeyword: 'react,vue,angular', content: 'React, Vue, Angular，三大前端框架各有千秋。\n\n本文將從學習曲線、生態系、效能表現等角度進行比較，幫助你找到最適合專案的選擇。' }
            ];

            // --- DOM 元素獲取 ---
            const gridView = document.getElementById('grid-view');
            const articleView = document.getElementById('article-view');
            const grid = document.getElementById('articles-grid');
            const editModeBtn = document.getElementById('edit-mode-toggle');
            const newPostBtn = document.getElementById('new-post-btn');
            const backBtn = document.getElementById('back-to-grid-btn');
            const saveBtn = document.getElementById('save-post-btn');

            // --- 核心功能函式 ---

            function loadArticles() {
                const storedArticles = localStorage.getItem('myCoolBlogArticles');
                articles = storedArticles ? JSON.parse(storedArticles) : defaultArticles;
                saveArticles();
            }

            function saveArticles() {
                localStorage.setItem('myCoolBlogArticles', JSON.stringify(articles));
            }

            function renderArticles(filterCategory = 'all') {
                grid.innerHTML = '';
                const filteredArticles = (filterCategory === 'all')
                    ? articles
                    : articles.filter(a => a.category === filterCategory);
                
                filteredArticles.forEach(article => {
                    const articleCard = document.createElement('div');
                    articleCard.className = 'article-card';
                    articleCard.dataset.id = article.id;
                    
                    const snippet = article.content.substring(0, 100).replace(/#/g, '') + '...';

                    articleCard.innerHTML = `
                        <img class="card-image" src="https://source.unsplash.com/random/800x600?${article.imageKeyword}" alt="${article.title}">
                        <div class="card-content">
                            <div class="card-tags">
                                <span class="tag ${article.category}">${getCategoryName(article.category)}</span>
                            </div>
                            <h3>${article.title}</h3>
                            <p>${snippet}</p>
                        </div>
                    `;
                    articleCard.addEventListener('click', () => showArticleView(article.id));
                    grid.appendChild(articleCard);
                });
            }

            function showView(viewName) {
                if (viewName === 'article') {
                    gridView.style.pointerEvents = 'none';
                    articleView.classList.add('visible');
                } else {
                    gridView.style.pointerEvents = 'auto';
                    articleView.classList.remove('visible');
                }
            }
            
            function showArticleView(id) {
                currentEditingId = id;
                const article = articles.find(a => a.id === id);
                const renderedContent = document.getElementById('article-content-rendered');
                const editForm = document.getElementById('article-edit-form');

                if (isEditMode) {
                    renderedContent.classList.add('hidden');
                    editForm.classList.remove('hidden');
                    
                    document.getElementById('article-title-input').value = article.title;
                    document.getElementById('article-category-select').value = article.category;
                    document.getElementById('article-image-input').value = article.imageKeyword;
                    document.getElementById('article-content-textarea').value = article.content;

                } else {
                    renderedContent.classList.remove('hidden');
                    editForm.classList.add('hidden');
                    
                    // 使用 marked.js 解析 Markdown
                    renderedContent.innerHTML = marked.parse(article.content);
                }
                showView('article');
            }
            
            function handleNewPost() {
                const newId = Date.now(); // 使用時間戳作為唯一ID
                const newArticle = {
                    id: newId,
                    category: 'tech',
                    title: '新文章標題',
                    imageKeyword: 'new,post',
                    content: '# 在這裡寫下你的新點子...'
                };
                articles.push(newArticle);
                saveArticles();
                showArticleView(newId);
            }

            function handleSavePost() {
                const articleIndex = articles.findIndex(a => a.id === currentEditingId);
                if (articleIndex === -1) return;

                articles[articleIndex].title = document.getElementById('article-title-input').value;
                articles[articleIndex].category = document.getElementById('article-category-select').value;
                articles[articleIndex].imageKeyword = document.getElementById('article-image-input').value;
                articles[articleIndex].content = document.getElementById('article-content-textarea').value;

                saveArticles();
                alert('文章已儲存！');
                showView('grid');
                renderArticles(document.querySelector('.nav-btn.active').dataset.category);
            }

            function toggleEditMode() {
                if (isEditMode) {
                    isEditMode = false;
                    editModeBtn.textContent = '啟用編輯模式';
                    editModeBtn.classList.remove('active');
                    newPostBtn.style.display = 'none';
                    alert('編輯模式已關閉。');
                } else {
                    const password = prompt('請輸入管理密碼:');
                    if (password === adminPassword) {
                        isEditMode = true;
                        editModeBtn.textContent = '編輯模式已啟用';
                        editModeBtn.classList.add('active');
                        newPostBtn.style.display = 'inline-block';
                        alert('歡迎回來！編輯模式已成功啟用。');
                    } else if (password !== null) {
                        alert('密碼錯誤！');
                    }
                }
            }

            function getCategoryName(category) {
                const names = { tech: '技術分享', life: '生活隨筆', travel: '旅行紀錄' };
                return names[category] || '未分類';
            }

            // --- 事件監聽器綁定 ---
            editModeBtn.addEventListener('click', toggleEditMode);
            newPostBtn.addEventListener('click', handleNewPost);
            backBtn.addEventListener('click', () => {
                showView('grid');
                renderArticles(document.querySelector('.nav-btn.active').dataset.category);
            });
            saveBtn.addEventListener('click', handleSavePost);

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    renderArticles(e.target.dataset.category);
                });
            });

            // --- 程式初始化 ---
            loadArticles();
            renderArticles();
        });
    </script>
</body>
</html>